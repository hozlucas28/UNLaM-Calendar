---
assert_lefthook_installed: true

pre-commit:
  jobs:
    - name: " Lint and format"
      group:
        parallel: true
        jobs:
          - name: " Format with prettier"
            run: bun run prettier {staged_files} --write --ignore-unknown --no-color --no-error-on-unmatched-pattern
            glob:
              - "*.astro"
              - "*.{yml,yaml}"
              - "*.md"
              - "*.mermaid"
            stage_fixed: true

          - name: " Format with biome"
            run: |
              for stagedFile in {staged_files}; do
                echo "$stagedFile"
              done
              echo ""
              bun run --bun biome format --write --staged --colors=off --no-errors-on-unmatched
            glob:
              - "*.html"
              - "*.css"
              - "*.{js,jsx}"
              - "*.{ts,tsx}"
              - "*.json"
            stage_fixed: true

          - name: " Lint and format Golang files (applying fixes)"
            run: golangci-lint run {staged_files} -v --fix --color=never
            glob:
              - "go.mod"
              - "go.sum"
              - "*.go"
            stage_fixed: true

    - name: " Lint"
      group:
        parallel: true
        jobs:
          - name: " Scan leaked secrets"
            run: gitleaks git --pre-commit --staged --verbose --no-color --no-banner

          - name: " Lint Dependabot files and GitHub Actions workflows"
            run: zizmor {staged_files} --color=never
            glob:
              - ".github/dependabot.{yml,yaml}"
              - ".github/workflows/*.{yml,yaml}"
